{% extends "users/base.html" %}
{% load custom_filters %}
{% block title %}–ü–æ—Å—Ç –ø—Ä–∏—ë–º–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö{% endblock %}

{% block content %}
<div class="container py-4">
    <a href="{% url 'incoming_workshop_dashboard' %}" class="btn btn-outline-secondary mb-4">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0 text-center flex-grow-1">–¢–∞–±–ª–∏—Ü–∞ –æ—Å–º–æ—Ç—Ä–æ–≤ ‚Äî –ó–æ–Ω–∞ –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö</h3>
        <button class="btn btn-sm btn-primary ms-3" onclick="toggleFullScreen()">üîç –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
    </div>

    <div id="table-container" class="">
        <table id="inspection-table" class="table table-bordered table-hover table-striped align-middle w-100" style="min-width: 1400px;">
            <thead class="table-dark text-center">
                <tr>
                    <th>‚Ññ</th>
                    <th>VIN</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–í—Ä–µ–º—è –æ—Å–º–æ—Ç—Ä–∞</th>
                    <th>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</th>
                    <th>–ù–æ–º–µ—Ä –¥–≤–∏–≥–∞—Ç–µ–ª—è</th>
                    <th>–§–æ—Ç–æ –¥–≤–∏–≥–∞—Ç–µ–ª—è</th>
                    <th>–§–æ—Ç–æ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö</th>
                    <th>–î–µ—Ç–∞–ª—å</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–¥–µ—Ç–∞–ª—å)</th>
                    <th>–î–µ—Ñ–µ–∫—Ç</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–¥–µ—Ñ–µ–∫—Ç)</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–°—Ç–µ–ø–µ–Ω—å</th>
                    <th>–¢–∏–ø —Ä–µ–º–æ–Ω—Ç–∞</th>
                    <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                    <th>–§–æ—Ç–æ –¥–µ—Ñ–µ–∫—Ç–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for row in records %}
                <tr class="{% if row.has_defect %}table-danger{% else %}table-success{% endif %}">
                    <td class="text-center">{{ forloop.counter }}</td>
                    <td>{{ row.vin }}</td>
                    <td>{{ row.date|date:"d.m.Y H:i" }}</td>
                    <td class="text-center">
                        {{ row.inspection_time|duration_fmt }}
                    </td>
                    <td>{{ row.controller }}</td>
                    <td>{{ row.engine_number }}</td>

                    <td>
                        {% if row.engine_photo %}
                            <img src="{{ row.engine_photo }}" class="clickable-img" width="60"
                                 onclick="openModal(['{{ row.engine_photo }}'], 0)">
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>

                    <td>
                        <div style="display: grid; gap: 4px; grid-template-columns: repeat(3, 1fr);">
                            {% for img in row.component_photos %}
                                <img src="{{ img }}" class="clickable-img" width="60"
                                     onclick="openModal([{% for i in row.component_photos %}'{{ i }}'{% if not forloop.last %}, {% endif %}{% endfor %}], {{ forloop.counter0 }})">
                            {% endfor %}
                        </div>
                    </td>

                    <td>{{ row.detail }}</td>
                    <td>{{ row.extra_comment }}</td>
                    <td>{{ row.defect }}</td>
                    <td>{{ row.comment }}</td>
                    <td>{{ row.quantity }}</td>
                    <td>{{ row.grade }}</td>
                    <td>{{ row.repair_type }}</td>
                    <td>{{ row.responsible }}</td>

                    <td>
                        <div style="display: grid; gap: 4px; grid-template-columns: repeat(3, 1fr);">
                            {% for img in row.photos %}
                                <img src="{{ img }}" class="clickable-img" width="60"
                                     onclick="openModal([{% for i in row.photos %}'{{ i }}'{% if not forloop.last %}, {% endif %}{% endfor %}], {{ forloop.counter0 }})">
                            {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- üñº –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–∞–ª–µ—Ä–µ–∏ -->
<div id="image-modal" class="modal" style="display: none;">
    <span class="close" onclick="closeModal()">&times;</span>
    <img id="modal-img" class="modal-content">
    <button id="prev-btn" class="nav-btn left" onclick="showPrev()">&#10094;</button>
    <button id="next-btn" class="nav-btn right" onclick="showNext()">&#10095;</button>
</div>
{% endblock %}