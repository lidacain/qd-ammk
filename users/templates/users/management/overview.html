{% extends "users/base.html" %}
{% block title %}–†–í–î ‚Äî –î–µ–ª–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="mb-3">
        <a href="{% url 'master_dashboard' %}" class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
    </div>

    <h2 class="text-center mb-4">–í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>

    <!-- üë®‚Äçüíº –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—á–∞–ª—å–Ω–∏–∫–æ–≤ —É—á–∞—Å—Ç–∫–æ–≤ -->
    <div class="mb-4">
        <div class="mb-3 d-flex justify-content-between align-items-center">
            <h5>–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫ –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö</h5>
            <a href="{% url 'office_overtime_overview' %}" class="btn btn-outline-primary">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –≤—ã—Ö–æ–¥–Ω—ã—Ö
            </a>
        </div>
        <h5>–ù–∞—á–∞–ª—å–Ω–∏–∫–∏ —É—á–∞—Å—Ç–∫–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h5>
        <table class="table table-bordered table-sm table-hover text-center w-50">
            <thead class="table-light">
                <tr>
                    <th>–ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in manager_stats %}
                    <tr class="table-row-clickable {% if stat.id == current_manager %}table-active{% endif %}"
                        onclick="window.location.href='?manager={{ stat.id }}'">
                        <td>{{ stat.manager.get_full_name_with_patronymic|default:stat.manager.username }}</td>
                        <td>{{ stat.count }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if current_manager %}
            <div class="text-end">
                <a href="{% url 'office_overview' %}" class="btn btn-outline-secondary btn-sm">
                    üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                </a>
            </div>
        {% endif %}
    </div>

        <!-- üìÑ –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <span class="badge bg-success">–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: {{ grouped|length }}</span>
        <div>
            <a href="{% url 'export_rvd_excel' %}" class="btn btn-success">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
            <a href="{% url 'export_word_rvd' %}" class="btn btn-primary">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ Word</a>

            <form method="post" action="{% url 'delete_all_selections_dp' %}" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger">üóë –£–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
            </form>
        </div>
    </div>

    {% if grouped %}
        <div class="table-responsive">
            <table class="table table-bordered table-sm table-hover align-middle">
                <thead class="table-light text-center">
                    <tr>
                        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                        <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                        <th>–û—Ç–¥–µ–ª</th>
                        <th>–î–∞—Ç—ã</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ß–∞—Å—ã</th>
                        <th>–•–¢–ö</th>
                        <th>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ</th>
                        <th>–ù–∞—á–∞–ª—å–Ω–∏–∫ —É—á–∞—Å—Ç–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employee_id, data in grouped.items %}
                        <tr>
                            <td>{{ data.name }}</td>
                            <td>{{ data.position }}</td>
                            <td>{{ data.department }}</td>
                            <td>
                                {% for d in data.dates %}
                                    {{ d }}<br>
                                {% endfor %}
                            </td>
                            <td class="text-center">{{ data.start_time }} ‚Äì {{ data.end_time }}</td>
                            <td class="text-center">{{ data.hours }}</td>
                            <td class="text-center">
                                {% if data.is_xtk %}‚úÖ{% else %}‚Äî{% endif %}
                            </td>
                            <td>{{ data.justification }}</td>
                            <td>{{ data.manager }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info text-center">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</div>
    {% endif %}
</div>

<style>
.table-row-clickable {
    cursor: pointer;
}
.table-row-clickable:hover {
    background-color: #f1f1f1;
}
</style>
{% endblock %}