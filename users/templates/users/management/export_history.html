{% extends "users/base.html" %}

{% block title %}–ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">üì¶ –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–æ–≤</h2>

    {% if history %}
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                    <th>–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞</th>
                    <th>–ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for record in history %}
                <tr>
                    <td>{{ record.file_name }}</td>
                    <td>{{ record.export_date|date:"d.m.Y H:i" }}</td>
                    <td>{{ record.record_count }}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#detailsModal{{ record.id }}">
                                üîç –î–µ—Ç–∞–ª–∏
                            </button>
                            <a href="{% url 're_export_excel' record.id %}" class="btn btn-success">
                                üîÅ –≠–∫—Å–ø–æ—Ä—Ç
                            </a>
                            <a href="{% url 'load_export_to_selection' record.id %}" class="btn btn-primary">
                                üìù –í —Å–ø–∏—Å–æ–∫
                            </a>
                            <a href="{% url 'edit_export_history' record.id %}" class="btn btn-warning">
                                ‚úèÔ∏è –ò–º—è
                            </a>
                            <a href="{% url 'delete_export_history' record.id %}" class="btn btn-danger">
                                üóëÔ∏è
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    {% for record in history %}
    <div class="modal fade" id="detailsModal{{ record.id }}" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞: {{ record.file_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>–î–∞—Ç–∞:</strong> {{ record.export_date|date:"d.m.Y H:i" }}</p>
                    <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:</strong> {{ record.record_count }}</p>

                    <div class="table-responsive mt-3">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                                    <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                                    <th>–û—Ç–¥–µ–ª</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–•–¢–ö</th>
                                    <th>–ß–∞—Å—ã</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in record.get_data_as_list %}
                                <tr>
                                    <td>{{ item.–°–æ—Ç—Ä—É–¥–Ω–∏–∫|default:item.Name }}</td>
                                    <td>{{ item.–î–æ–ª–∂–Ω–æ—Å—Ç—å|default:item.Position }}</td>
                                    <td>{{ item.–û—Ç–¥–µ–ª|default:item.Department }}</td>
                                    <td>{{ item.–î–∞—Ç–∞|default:item.Selected_Date }}</td>
                                    <td>{{ item.–•–¢–ö|default:"–ù–µ—Ç" }}</td>
                                    <td>{{ item.–ß–∞—Å—ã|default:"8" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="{% url 'load_export_to_selection' record.id %}" class="btn btn-primary">üìù –í —Å–ø–∏—Å–æ–∫</a>
                    <a href="{% url 're_export_excel' record.id %}" class="btn btn-success">üîÅ –≠–∫—Å–ø–æ—Ä—Ç</a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="alert alert-info">–ü–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤.</div>
    {% endif %}

    <div class="mt-4">
        <a href="{% url 'employee_search' %}" class="btn btn-secondary">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a>
    </div>
</div>
{% endblock %}